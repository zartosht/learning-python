<script>
  $(document).ready(function () {
    const loaderjs = document.createElement('script');
    loaderjs.src = '/assets/js/loader.js';

    loaderjs.onload = function () {
      require.config({
        paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' }
      });
      require(['vs/editor/editor.main'], function () {
        const codeContainers = document.querySelectorAll('pre > code');

        codeContainers.forEach((codeContainer) => {
          const pre = codeContainer.parentElement;

          const monacoContainer = document.createElement('div');
          monacoContainer.className = 'monaco-container';

          const monacoEditor = document.createElement('div');
          monacoEditor.className = 'editor';

          const monacoResizeBar = document.createElement('div');
          monacoResizeBar.className = 'resize-bar';

          monacoContainer.appendChild(monacoEditor);
          monacoContainer.appendChild(monacoResizeBar);

          // Insert the new container after the pre
          pre.parentElement.insertBefore(monacoContainer, pre.nextSibling);

          const editor = monaco.editor.create(monacoEditor, {
            value: codeContainer.textContent,
            language: 'python',
            theme: 'vs-dark',
            fontSize: 16,
          });

          // Set the editor size to the pre size
          const width = pre.offsetWidth;
          const height = pre.offsetHeight;
          editor.layout({ width, height: height + 10 });

          // The editor is ready to be used
          // Hide the original code
          pre.style.display = 'none';
        });
      });
    };

    document.body.appendChild(loaderjs);
  });
</script>